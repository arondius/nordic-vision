	var jq = jQuery.noConflict();	jq(document).ready(function() {	        jq("#gallery").lightSlider({			slideWidth:850,			gallery:true,			thumbWidth:100,			thumbMargin:6.25,            minSlide:1,            maxSlide:1,            auto:true,            mode:'slide',            proportion:'100%',            onSliderLoad: function() {                jq('#gallery').removeClass('cS-hidden');            }  		});			jq('.radio').bind('click.uniform',			function (e) {				if (jq(this).find("span").hasClass('checked')) 					jq(this).find("input").attr('checked', true);				else					jq(this).find("input").attr('checked', false);			}		);		jq('.book-accommodation').on('click', function(event) {			jq('#wait_loading').show();					var buttonId = jq(this).attr('id');			if (!window.accommodationIsSelfCatered)				window.roomTypeId = buttonId.replace('book-accommodation-', '');			else				window.roomTypeId = 0;			window.accommodationVacancyDays = getAccommodationAvailableDates(window.accommodationId, window.roomTypeId, window.currentMonth, window.currentYear);						bindAccommodationDatePicker();						if (window.roomTypeId > 0) {				jq('.bf_room_type_cell').show();				jq('#room_type').html(jq('li#room_type_' + roomTypeId + ' .room_type h2').html());			} else {				jq('.bf_room_type_cell').hide();			}						bindAccommodationControls(window.accommodationId, window.roomTypeId);			showAccommodationBookingForm();			jq('#wait_loading').hide();			event.preventDefault();		});		jq('#accommodation-booking-form').validate({			onkeyup: false,			ignore: [],			rules: {				first_name: {					required: true				},				last_name: "required",				email: {					required: true,					email: true				},				confirm_email: {					required: true,					equalTo: "#email"				},				phone: "required",				address: "required",				town: "required",				zip: "required",				country: "required",				date_from1: "required",				date_to1: "required"			},			invalidHandler: function(e, validator) {				var errors = validator.numberOfInvalids();				if (errors) {					var message = errors == 1						? window.formSingleError						: window.formMultipleError.format(errors);					jq("div.error div p").html(message);					jq("div.error").show();				} else {					jq("div.error").hide();				}			},			messages: {				first_name: window.bookingFormFirstNameError,				last_name: window.bookingFormLastNameError,				email: window.bookingFormEmailError,				confirm_email: {					required: window.bookingFormConfirmEmailError1,					equalTo: window.bookingFormConfirmEmailError2				},				phone: window.bookingFormPhoneError,				address: window.bookingFormAddressError,				town: window.bookingFormCityError,				zip: window.bookingFormZipError,				country: window.bookingFormCountryError,				date_from1: window.bookingFormDatesError,				date_to1: window.bookingFormDatesError			},			submitHandler: function() { processAccommodationBooking(); }		});				jq('#cancel-accommodation-booking').on('click', function(event) {			hideAccommodationBookingForm();			showAccommodationInfo();		});				});		function  bindAccommodationDatePicker() {			if (typeof jq('#accommodation_vacancy_datepicker') !== 'undefined') {			jq('#accommodation_vacancy_datepicker').datepicker({				dateFormat: window.datepickerDateFormat,				numberOfMonths: 1,				minDate: 0,				beforeShowDay: function(d) {					var date1 = null;					var date2 = null;					if (jq("#date_from1").val())						date1 = jq.datepicker.parseDate(window.datepickerDateFormat, jq("#date_from1").val());					if (jq("#date_to1").val())						date2 = jq.datepicker.parseDate(window.datepickerDateFormat, jq("#date_to1").val());					if (window.accommodationVacancyDays) {						var dateTextForCompare = d.getFullYear() + '-' + ("0" + (d.getMonth() + 1)).slice(-2) + '-' + ("0" + d.getDate()).slice(-2);						if (jq.inArray(dateTextForCompare, window.accommodationVacancyDays) == -1)							return [false, 'ui-datepicker-unselectable ui-state-disabled'];					}										return [true, date1 && ((d.getTime() == date1.getTime()) || (date2 && d >= date1 && d <= date2)) ? "dp-highlight" : ""];				},				onSelect: function(dateText, inst) {					var dateTextForParse = inst.currentYear + '-' + (inst.currentMonth + 1) + '-' + ("0" + inst.currentDay).slice(-2);					var date1 = null;					if (jq("#date_from1").val())						date1 = jq.datepicker.parseDate(window.datepickerDateFormat, jq("#date_from1").val());					var date2 = null;					if (jq("#date_to1").val())						date2 = jq.datepicker.parseDate(window.datepickerDateFormat, jq("#date_to1").val());					if (!date1 || date2) {						jq("#date_from").html(dateText);						jq("#date_from1").val(dateText);						jq("#date_to").html("");						jq("#date_to1").val("");						jq(".dates_row").hide();						jq(".price_row").hide();					} else {						var dateCompare = Date.parse(dateTextForParse);						if (dateCompare < date1)						{							jq("#date_from").html(dateText);							jq("#date_from1").val(dateText);							jq("#date_to").html("");							jq("#date_to1").val("");														jq(".dates_row").hide();							jq(".price_row").hide();						}						else						{							var allOk = true;							for (var d = date1; d <= date2; d.setDate(d.getDate() + 1)) {								var dateTextForCompare = d.getFullYear() + '-' + ("0" + (d.getMonth() + 1)).slice(-2) + '-' +  ("0" + d.getDate()).slice(-2);								if (jq.inArray(dateTextForCompare, window.accommodationVacancyDays) == -1)									allOk = false;							}														if (!allOk) {								jq("#date_from").html(dateText);								jq("#date_from1").val(dateText);								jq("#date_to").html("");								jq("#date_to1").val("");																	jq(".dates_row").hide();								jq(".price_row").hide();							} else {								jq("#date_to").html(dateText);								jq("#date_to1").val(dateText);																var dateFromText = jq("#date_from1").val();								var dateToText = jq("#date_to1").val();								date1 = jq.datepicker.parseDate(window.datepickerDateFormat, dateFromText);								date2 = jq.datepicker.parseDate(window.datepickerDateFormat, dateToText);																if (date1.valueOf() == date2.valueOf()) {									date2.setDate(date1.getDate() + 1);									var temp = date2.getFullYear() + '-' + ("0" + (date2.getMonth() + 1)).slice(-2) + '-' +  ("0" + date2.getDate()).slice(-2);									jq("#date_to1").val(temp);									jq("#date_to").html(temp);								}																window.bookingDateFrom = date1;								window.bookingDateTo = date2;																bindAccommodationRatesTable();							}						}					}				},				onChangeMonthYear: function (year, month, inst) {					window.currentMonth = month;					window.currentYear = year;					window.accommodationVacancyDays = getAccommodationAvailableDates(window.accommodationId, window.roomTypeId, window.currentMonth, window.currentYear);					bindAccommodationDatePicker();				}			});		}		}	function processAccommodationBooking() {				jq('#wait_loading').show();				var dateFrom = new Date(window.bookingDateFrom.valueOf());		var dateFrom = dateFrom.getDate() + "-" + (dateFrom.getMonth() + 1) + "-" + dateFrom.getFullYear(); 		var dateTo = new Date(window.bookingDateTo.valueOf());		var dateTo = dateTo.getDate() + "-" + (dateTo.getMonth() + 1) + "-" + dateTo.getFullYear(); 				if (!window.roomTypeId)			window.roomTypeId = 0;					var firstName = jq('#first_name').val();		var lastName = jq('#last_name').val();		var email = jq('#email').val();		var phone = jq('#phone').val();		var address = jq('#address').val();		var town = jq('#town').val();		var zip = jq('#zip').val();		var country = jq('#country').val();		var requirements = jq('#requirements').val();				var roomCount = jq('#room_count').val();		if (!roomCount)			roomCount = 1;				var adults = jq('#booking_form_adults').val();		if (!adults)			adults = 1;					var children = jq('#booking_form_children').val();		if (!children)			children = 0;					var cValS = jq('#c_val_s').val();		var cVal1 = jq('#c_val_1').val();		var cVal2 = jq('#c_val_2').val();		jq("#confirm_first_name").html(firstName);		jq("#confirm_last_name").html(lastName);		jq("#confirm_email_address").html(email);		jq("#confirm_phone").html(phone);		jq("#confirm_street").html(address);		jq("#confirm_town").html(town);		jq("#confirm_zip").html(zip);		jq("#confirm_country").html(country);		jq("#confirm_requirements").html(requirements);		jq("#confirm_adults").html(adults);		jq("#confirm_children").html(children);		jq("#confirm_date_from").html(dateFrom);		jq("#confirm_date_to").html(dateTo);				jq.ajax({			url: BYTAjax.ajaxurl,			data: {				'action':'book_accommodation_ajax_request',				'first_name' : firstName,				'last_name' : lastName,				'email' : email,				'phone' : phone,				'address' : address,				'town' : town,				'zip' : zip,				'country' : country,				'requirements' : requirements,				'date_to' : dateTo,				'date_from' : dateFrom,				'accommodation_id' : window.accommodationId,				'room_type_id' : window.roomTypeId,				'room_count' : roomCount,				'c_val_s' : cValS,				'c_val_1' : cVal1,				'c_val_2' : cVal2,				'adults' : adults,				'children' : children,				'nonce' : BYTAjax.nonce			},			success:function(data) {				// This outputs the result of the ajax request				if (data == 'captcha_error') {					jq("div.error div p").html(window.InvalidCaptchaMessage);					jq("div.error").show();				} else {					var returnedId = data;					jq("div.error div p").html('');					jq("div.error").hide();					var isReservationOnly = getAccommodationIsReservationOnly(window.accommodationId);										if (window.useWoocommerceForCheckout && window.wooCartPageUri.length > 0 && !isReservationOnly) {						addAccProdToCart(returnedId);					} else {						hideAccommodationBookingForm();						showAccommodationConfirmationForm();						jq('#wait_loading').hide();					}				}			},			error: function(errorThrown){				console.log(errorThrown);			}		}); 	}	function addAccProdToCart(p_id) {		jq.get(window.site_url + '/?post_type=product&add-to-cart=' + p_id, function() {			accRedirectToCart();		});	}	function accRedirectToCart() {		top.location.href = window.wooCartPageUri;	}	function showAccommodationBookingForm() {		jq('#accommodation-booking-form').show();		jq('.three-fourth .gallery').hide();		jq('.three-fourth .inner-nav').hide();		jq('.three-fourth .tab-content').hide();	}	function hideAccommodationBookingForm() {		jq('#accommodation-booking-form').hide();	}				function showAccommodationConfirmationForm() {		jq('#accommodation-confirmation-form').show();	}	function showAccommodationInfo() {		jq('.three-fourth .gallery').show();		jq('.three-fourth .inner-nav').show();		jq('.three-fourth .tab-content').show();		jq(".tab-content").hide();		jq(".tab-content:first").show();		jq(".inner-nav li:first").addClass("active");	}	window.InitializeMap = (function() {		var secheltLoc = new google.maps.LatLng(window.accommodationLocationLatitude, window.accommodationLocationLongitude);		var myMapOptions = {			 zoom: 15			,center: secheltLoc			,mapTypeId: google.maps.MapTypeId.ROADMAP		};		var theMap = new google.maps.Map(document.getElementById("map_canvas"), myMapOptions);		google.maps.event.trigger(theMap, 'resize');				var marker = new google.maps.Marker({			map: theMap,			draggable: true,			position: new google.maps.LatLng(window.accommodationLocationLatitude, window.accommodationLocationLongitude),			visible: true		});		var boxText = document.createElement("div");		boxText.innerHTML = "<strong>" + window.accommodationTitle + "</strong><br />" + window.accommodationAddress + "<br />" + window.accommodationWebsite + "";		var myOptions = {			 content: boxText			,disableAutoPan: false			,maxWidth: 0			,pixelOffset: new google.maps.Size(-140, 0)			,zIndex: null			,closeBoxURL: ""			,infoBoxClearance: new google.maps.Size(1, 1)			,isHidden: false			,pane: "floatPane"			,enableEventPropagation: false		};		google.maps.event.addListener(marker, "click", function (e) {			ib.open(theMap, this);		});		var ib = new InfoBox(myOptions);		ib.open(theMap, marker);	});	function bindAccommodationRatesTable() {				// window.accommodationId, window.roomTypeId, window.accommodationIsPricePerPerson, window.accommodationCountChildrenStayFree		jq(".dates_row").show();		jq(".price_row").show();		jq('table.breakdown thead').html('');		jq('table.breakdown tfoot').html('');		jq('table.breakdown tbody').html('');		var room_count = jq('#room_count').val();		if (!room_count)			room_count = 1;				var adults = jq('#booking_form_adults').val();		if (!adults)			adults = 1;					var children = jq('#booking_form_children').val();		if (!children)			children = 0;				var headerRow = '<tr class="rates_head_row">';		var colCount = 2;				headerRow += '<th>' + window.dateLabel + '</th>';						if (window.accommodationIsPricePerPerson) {			headerRow += '<th>' + window.adultCountLabel + '</th>';			headerRow += '<th>' + window.pricePerAdultLabel + '</th>';			headerRow += '<th>' + window.childCountLabel + '</th>';			headerRow += '<th>' + window.pricePerChildLabel + '</th>';			colCount = 6;		} 		headerRow += '<th>' + window.pricePerDayLabel + '</th>';						headerRow += '</tr>';		jq('table.breakdown thead').append(headerRow);					var footerRow = '<tr>';		footerRow += '<th colspan="' + (colCount - 1) + '">' + window.priceTotalLabel + '</th>';		footerRow += '<td class="total_price">0</td>';		footerRow += '</tr>';		jq('table.breakdown tfoot').append(footerRow);				if (window.bookingDateFrom && window.bookingDateTo) {					jq('#datepicker_loading').show();					var fromTime = window.bookingDateFrom.valueOf();			var toTime = window.bookingDateTo.valueOf();			window.rateTableTotalRows = 0;						while (fromTime < toTime) {							window.rateTableTotalRows++;				fromTime += 86400000;			}						window.rateTableTotalPrice = 0;			window.rateTableRowIndex = 0;						fromTime = window.bookingDateFrom.valueOf();			toTime = window.bookingDateTo.valueOf();						while (fromTime < toTime) {					buildAccommodationRateRow(fromTime, adults, children, colCount);				fromTime += 86400000;			}		}			}	function bindAccommodationControls(accommodation_id, room_type_id) {		if (jq('#booking_form_adults option').size() == 0) {					var max_count = 0;			var max_child_count = 0;						if (room_type_id > 0) {				max_count = jq('li#room_type_' + room_type_id + ' .room-information .max_count').val();				max_child_count = jq('li#room_type_' + room_type_id + ' .room-information .max_child_count').val();			} else {				max_count = 5;				max_child_count = 5;			}						if (!max_child_count)				max_child_count = 0;					for ( var i = 1; i <= max_count; i++ ) {				jq('<option ' + (i == 1 ? 'selected' : '') + '>').val(i).text(i).appendTo('#booking_form_adults');			}			jq("#booking_form_adults").uniform();						jq('#booking_form_adults').on('change', function (e) {				var optionSelected = jq("option:selected", this);				var valueSelected = this.value;				bindAccommodationRatesTable();							});			if (max_child_count > 0) {				jq('<option selected>').val(0).text(0).appendTo('#booking_form_children');				for ( var i = 1; i <= max_child_count; i++ ) {					jq('<option>').val(i).text(i).appendTo('#booking_form_children');				}				jq("#booking_form_children").uniform();								jq('#booking_form_children').on('change', function (e) {					var optionSelected = jq("option:selected", this);					var valueSelected = this.value;										bindAccommodationRatesTable();				});			} else {				jq('.booking_form_children').hide();			}		}			}	function getAccommodationAvailableDates(accommodationId, roomTypeId, month, year) {		var dateArray = new Array();		var dataObj = {			'action':'accommodation_available_dates_request',			'accommodationId' : accommodationId,			'roomTypeId' : roomTypeId,			'month' : month,			'year' : year,			'nonce' : BYTAjax.nonce		}				jq.ajax({			url: BYTAjax.ajaxurl,			data: dataObj,			async: false,			success:function(json) {				// This outputs the result of the ajax request				var availableDates = JSON.parse(json);				var i = 0;				for (i = 0; i < availableDates.length; ++i) {					dateArray.push(availableDates[i].single_date);				}			},			error: function(errorThrown){				console.log(errorThrown);			}		});		return dateArray;	}		function getAccommodationIsReservationOnly(accommodationId) {		var isReservationOnly = 0;		var dataObj = {			'action':'accommodation_is_reservation_only_request',			'accommodation_id' : accommodationId,			'nonce' : BYTAjax.nonce		}				jq.ajax({			url: BYTAjax.ajaxurl,			data: dataObj,			async: false,			success:function(data) {				// This outputs the result of the ajax request				isReservationOnly = data;			},			error: function(errorThrown){				console.log(errorThrown);			}		});		return isReservationOnly;	}		function buildAccommodationRateRow(fromTime, adults, children, colCount) {			var price = 0;				var d = new Date(fromTime);		var day = d.getDate();		var month = d.getMonth() + 1;		var year = d.getFullYear();		var dateValue = day + "-" + month + "-" + year; 		var dataObj = {			'action':'accommodation_get_price_request',			'roomTypeId' : window.roomTypeId,			'accommodationId' : window.accommodationId,			'dateValue' : dateValue,			'nonce' : BYTAjax.nonce		}				jq.ajax({			url: BYTAjax.ajaxurl,			data: dataObj,			dataType: 'json',			success:function(prices) {				var tableRow = '';				// This outputs the result of the ajax request				window.rateTableRowIndex++;				var pricePerDay = parseFloat(prices.price_per_day);				var pricePerChild = 0;								tableRow += '<tr>';				tableRow += '<td>' + dateValue + '</td>';								if (window.accommodationIsPricePerPerson) {					pricePerChild = parseFloat(prices.child_price);					tableRow += '<td>' + adults + '</td>';					tableRow += '<td>' + window.currencySymbol + pricePerDay + '</td>';					tableRow += '<td>' + children + (window.accommodationCountChildrenStayFree > 0 ? ' *' : '') + '</td>';					tableRow += '<td>' + window.currencySymbol + pricePerChild + '</td>';				} 								if (window.accommodationIsPricePerPerson) {					children = children - window.accommodationCountChildrenStayFree;					children = children >= 0 ? children : 0;					pricePerDay = (pricePerDay * adults) + (pricePerChild * children);				} else {					pricePerDay = pricePerDay;				}								window.rateTableTotalPrice += pricePerDay;								jq('.total_price').html(window.currencySymbol + ' ' + window.rateTableTotalPrice);				jq("#confirm_total").html(window.currencySymbol + ' ' + window.rateTableTotalPrice)								tableRow += '<td>' + window.currencySymbol + pricePerDay + '</td>';										tableRow += '</tr>';								jq('table.breakdown tbody').append(tableRow);								if (window.rateTableRowIndex == window.rateTableTotalRows) {										if (jq("table.breakdown").data('tablesorter') == null) {						jq("table.breakdown").tablesorter({							debug:true,							dateFormat: 'ddmmyyyy',							sortList: [[0,0]]						});					}										jq("table.breakdown").trigger("update");					jq("table.breakdown").trigger("sorton", [[[0,0]]]);					jq('#datepicker_loading').hide();				}			},			error: function(errorThrown){				console.log(errorThrown);			}		});		}	